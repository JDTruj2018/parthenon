<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to add tests to Parthenon &mdash; Parthenon  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running a Weak Scaling Test in Parthenon" href="weak_scaling.html" />
    <link rel="prev" title="Tasks" href="tasks.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Parthenon
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="amr.html">Adaptive Mesh Refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary_communication.html">Boundary communication-in-one concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary_communication.html#sparse-boundary-communication">Sparse boundary communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary_conditions.html">Boundary Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building Parthenon</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts_lite.html">C++11 Style Concepts Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="constants.html">Parthenon Built-in Physical Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinates.html">Coordinates</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Parthenon developer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="driver.html">Application Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrators.html">Integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_balancing.html">Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="nested_par_for.html">Nested Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="parthenon_arrays.html">Parthenon Set-Dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="parthenon_arrays.html#parthenon-arbitrary-dimensional-arrays">Parthenon Arbitrary-Dimensional Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="particles.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="reductions.html">Task-based reductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="solvers.html">Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinx-doc.html">How to Use Sphinx for Writing Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to add tests to Parthenon</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#regression-tests">Regression Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gold-files">Gold Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="weak_scaling.html">Running a Weak Scaling Test in Parthenon</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface/boundary.html">Boundary related classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface/containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface/metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface/refinement_operations.html">Prolongation and Restriction Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface/sparse.html">Sparse implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface/state.html">State Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh/domain.html">Domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh/mesh.html">Mesh</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Parthenon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to add tests to Parthenon</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/src/tests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-add-tests-to-parthenon">
<span id="tests"></span><h1>How to add tests to Parthenon<a class="headerlink" href="#how-to-add-tests-to-parthenon" title="Link to this heading"></a></h1>
<section id="unit-tests">
<h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Link to this heading"></a></h2>
<p>Unit tests are straightforward to implement. Open the <code class="docutils literal notranslate"><span class="pre">tst/unit</span></code>
directory to see the current test suites. You may either add a new
file to this directory (and the associated <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file, or
extend an existing file.</p>
<p>Parthenon uses the <a class="reference external" href="https://github.com/catchorg/Catch2/tree/v2.x">Catch2</a> unit test framework. Tests are typically
written in the following format:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_CASE</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[category1][category2]&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">GIVEN</span><span class="p">(</span><span class="s">&quot;Set up code&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// some code</span>
<span class="w">    </span><span class="n">WHEN</span><span class="p">(</span><span class="s">&quot;Trigger&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">THEN</span><span class="p">(</span><span class="s">&quot;Condition&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">REQUIRE</span><span class="p">(</span><span class="n">some_bool_expression</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See the Catch documentation for more details.</p>
</section>
<section id="regression-tests">
<h2>Regression Tests<a class="headerlink" href="#regression-tests" title="Link to this heading"></a></h2>
<p>The regression test infrastructure is more complicated, and our
regression test infrastructure is built on a mix of Python and
CMake. Each test is defined by a <em>test suite</em>. You can find the test
suites in the <code class="docutils literal notranslate"><span class="pre">tst/regression/test_suites</span></code> directory. Each test
suite is a Python module that defines a <code class="docutils literal notranslate"><span class="pre">TestCase</span></code> class, which
inherits from the abstract base class provided by the
<code class="docutils literal notranslate"><span class="pre">utils.test_case</span></code> module included in the test suite. A <code class="docutils literal notranslate"><span class="pre">TestCase</span></code>
class must implement the following methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Prepare(self,</span> <span class="pre">parameters,</span> <span class="pre">step)</span></code> is the python code which sets up
a simulation run. It modifies an included input deck for a given
test, based on the test design. The <code class="docutils literal notranslate"><span class="pre">parameters</span></code> input contains a
list of command line arguments that should modify the parthenon
run. These are passed in to the test infrastructure via CMake
(described below). The <code class="docutils literal notranslate"><span class="pre">step</span></code> argument is an integer. It is used
for regression tests that require multiple simulation runs, such as
a convergence test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Analyze(self,</span> <span class="pre">parameters)</span></code> is the post-processing step that
checks whether or not the test passed. Some tests compare to gold
files (described further below) and some simply compare to a known
solution.</p></li>
</ul>
<p>A test suite needs to have not only the python file containing the
<code class="docutils literal notranslate"><span class="pre">TestCase</span></code> class, but an empty <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file to match the
Python module API.</p>
<p>After adding a module, you must also modify the file
<code class="docutils literal notranslate"><span class="pre">tst/regression/CMakeLists.txt</span></code>. In particular for a new regression
test, you must add a set of arguments like these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>list(APPEND TEST_DIRS name_of_folder )
list(APPEND TEST_PROCS ${NUM_MPI_PROC_TESTING})
list(APPEND TEST_ARGS args_to_pass_to_run_test.py )
list(APPEND EXTRA_TEST_LABELS &quot;my-awesome-test&quot;)
</pre></div>
</div>
<p>The first argument specifies the name of the folder containing the new
python module for the new test. The second argument specifies number
of MPI ranks if the test should be run with MPI (specify 1 if
not). The third argument specifies arguments to pass to your test
suite, for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;--driver $</span><span class="si">{PROJECT_BINARY_DIR}</span><span class="s2">/example/advection/advection-example --driver_input $</span><span class="si">{CMAKE_CURRENT_SOURCE_DIR}</span><span class="s2">/test_suites/advection_performance/parthinput.advection_performance --num_steps 4&quot;</span>
</pre></div>
</div>
<p>which would specify which application to run for the test, as well as the input deck and the number of steps.</p>
<p>The final argument specifies labels attached to the test for use with
CTest.</p>
</section>
<section id="gold-files">
<h2>Gold Files<a class="headerlink" href="#gold-files" title="Link to this heading"></a></h2>
<p>Many tests use so-called <em>gold files</em>, files are files containing
known results to compare against. Parthenon bundles its gold files as
part of releases. These files are automatically downloaded and are
located in <code class="docutils literal notranslate"><span class="pre">tst/regression/gold_standard</span></code>. To add a new gold file
(or update an old one), place it in this directory.</p>
<p>To make the new (or updated) test official, you must add it to the
official test suite. First update
<code class="docutils literal notranslate"><span class="pre">tst/regression/gold_standard/README.rst</span></code> and add a new version of
the test suite, corresponding to the commit where you added the
relevant test code and an explanation for why the gold files needed to
change. Then run the script <code class="docutils literal notranslate"><span class="pre">`make_tarball.sh</span></code> as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">make_tarball</span><span class="o">.</span><span class="n">sh</span> <span class="n">NEW_VERSION</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">NEW_VERSION</span></code> is the new version of the gold files (not
necessarily tied to the version of the code release). You can then ask
a maintainer to create a new goldfile release and attach the resultant
tarball to the release.</p>
<p>As a sanity check, Parthenon checks against the <code class="docutils literal notranslate"><span class="pre">sha512</span></code> hash of the
tarball. The make tarball script will output the hash. The new version
and new hash must be set as the default values of the
<code class="docutils literal notranslate"><span class="pre">REGRESSION_GOLD_STANDARD_VER</span></code> and <code class="docutils literal notranslate"><span class="pre">REGRESSION_GOLD_STANDARD_HASH</span></code>
in the top level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tasks.html" class="btn btn-neutral float-left" title="Tasks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="weak_scaling.html" class="btn btn-neutral float-right" title="Running a Weak Scaling Test in Parthenon" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Parthenon Collaboration and Triad National Security.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: bprather/backport-solvers
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../regression-gold-v15/index.html">regression-gold-v15</a></dd>
      <dd><a href="../../../regression-gold-v16/index.html">regression-gold-v16</a></dd>
      <dd><a href="../../../regression-gold-v17/index.html">regression-gold-v17</a></dd>
      <dd><a href="../../../regression-gold-v18/index.html">regression-gold-v18</a></dd>
      <dd><a href="../../../regression-gold-v19/src/tests.html">regression-gold-v19</a></dd>
      <dd><a href="../../../v0.8.0/index.html">v0.8.0</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../bdw/gauss-quad/index.html">bdw/gauss-quad</a></dd>
      <dd><a href="../../backport-bicgstab/index.html">bprather/backport-bicgstab</a></dd>
      <dd><a href="tests.html">bprather/backport-solvers</a></dd>
      <dd><a href="../../fix-amr-ct/src/tests.html">bprather/fix-amr-ct</a></dd>
      <dd><a href="../../fix-line-continuation/src/tests.html">bprather/fix-line-continuation</a></dd>
      <dd><a href="../../fix-mpi-comms/index.html">bprather/fix-mpi-comms</a></dd>
      <dd><a href="../../mbd_add_niceties/src/tests.html">bprather/mbd_add_niceties</a></dd>
      <dd><a href="../../pep1/src/tests.html">bprather/pep1</a></dd>
      <dd><a href="../../print-less/src/tests.html">bprather/print-less</a></dd>
      <dd><a href="../../register-internal-op/src/tests.html">bprather/register-internal-op</a></dd>
      <dd><a href="../../reqs-for-ct/index.html">bprather/reqs-for-ct</a></dd>
      <dd><a href="../../../brryan/particle_idx_bug/index.html">brryan/particle_idx_bug</a></dd>
      <dd><a href="../../../develop/src/tests.html">develop</a></dd>
      <dd><a href="../../../forrestglines/cuda-with-nvc++-fix/src/tests.html">forrestglines/cuda-with-nvc++-fix</a></dd>
      <dd><a href="../../../forrestglines/curvilinear/src/tests.html">forrestglines/curvilinear</a></dd>
      <dd><a href="../../../forrestglines/fix-deprecated-kokkos-num-devices/src/tests.html">forrestglines/fix-deprecated-kokkos-num-devices</a></dd>
      <dd><a href="../../../jdolence/inactive_blocks/src/tests.html">jdolence/inactive_blocks</a></dd>
      <dd><a href="../../../jdolence/meshblockdata_add/src/tests.html">jdolence/meshblockdata_add</a></dd>
      <dd><a href="../../../jdolence/quickfixes/src/tests.html">jdolence/quickfixes</a></dd>
      <dd><a href="../../../jdolence/timer_based_loadbalancing/src/tests.html">jdolence/timer_based_loadbalancing</a></dd>
      <dd><a href="../../../jmm/deprecate-unified-init/src/tests.html">jmm/deprecate-unified-init</a></dd>
      <dd><a href="../../../jmm/fix-noparticle-case/index.html">jmm/fix-noparticle-case</a></dd>
      <dd><a href="../../../jmm/fix-restart/index.html">jmm/fix-restart</a></dd>
      <dd><a href="../../../jmm/fix-throw-fail/index.html">jmm/fix-throw-fail</a></dd>
      <dd><a href="../../../jmm/flat-sparse/index.html">jmm/flat-sparse</a></dd>
      <dd><a href="../../../jmm/flatpack-test/src/tests.html">jmm/flatpack-test</a></dd>
      <dd><a href="../../../jmm/get-me-off-this-rollercoaster/src/tests.html">jmm/get-me-off-this-rollercoaster</a></dd>
      <dd><a href="../../../jmm/hotfix-sparse-control-fields/src/tests.html">jmm/hotfix-sparse-control-fields</a></dd>
      <dd><a href="../../../jmm/metadata-fix/index.html">jmm/metadata-fix</a></dd>
      <dd><a href="../../../jmm/metadataset/index.html">jmm/metadataset</a></dd>
      <dd><a href="../../../jmm/particle-output/index.html">jmm/particle-output</a></dd>
      <dd><a href="../../../jmm/precomms-fill-derived/index.html">jmm/precomms-fill-derived</a></dd>
      <dd><a href="../../../lfroberts36/speedup-buffer-kernel/src/tests.html">lfroberts36/speedup-buffer-kernel</a></dd>
      <dd><a href="../../../lroberts36/add-index-range-masking/src/tests.html">lroberts36/add-index-range-masking</a></dd>
      <dd><a href="../../../lroberts36/add-morton-numbers/src/tests.html">lroberts36/add-morton-numbers</a></dd>
      <dd><a href="../../../lroberts36/add-multi-grid/src/tests.html">lroberts36/add-multi-grid</a></dd>
      <dd><a href="../../../lroberts36/add-negative-levels/src/tests.html">lroberts36/add-negative-levels</a></dd>
      <dd><a href="../../../lroberts36/add-noncell-amr/src/tests.html">lroberts36/add-noncell-amr</a></dd>
      <dd><a href="../../../lroberts36/boundary-exchange-test/index.html">lroberts36/boundary-exchange-test</a></dd>
      <dd><a href="../../../lroberts36/composable-boundary-conditions/index.html">lroberts36/composable-boundary-conditions</a></dd>
      <dd><a href="../../../lroberts36/face-boundary-communication/index.html">lroberts36/face-boundary-communication</a></dd>
      <dd><a href="../../../lroberts36/fix-dealloc-count-bug/src/tests.html">lroberts36/fix-dealloc-count-bug</a></dd>
      <dd><a href="../../../lroberts36/in-one-zero-memory-amr/src/tests.html">lroberts36/in-one-zero-memory-amr</a></dd>
      <dd><a href="../../../lroberts36/local-face-fields/index.html">lroberts36/local-face-fields</a></dd>
      <dd><a href="../../../lroberts36/refactor-region-size/src/tests.html">lroberts36/refactor-region-size</a></dd>
      <dd><a href="../../../lroberts36/rename-cell-variable/index.html">lroberts36/rename-cell-variable</a></dd>
      <dd><a href="../../../lroberts36/sparse-pack-update/index.html">lroberts36/sparse-pack-update</a></dd>
      <dd><a href="../../../pgrete/always-chunck/src/tests.html">pgrete/always-chunck</a></dd>
      <dd><a href="../../../pgrete/fix-ascent-vars/index.html">pgrete/fix-ascent-vars</a></dd>
      <dd><a href="../../../pgrete/fix-chunk/src/tests.html">pgrete/fix-chunk</a></dd>
      <dd><a href="../../../pgrete/sycl-test/index.html">pgrete/sycl-test</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>